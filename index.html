<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Member Management System</title>
<script src="https://cdn.tailwindcss.com"></script>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
@media (max-width: 768px) {
  table { font-size: 0.85rem; }
  th, td { padding: 6px; }
  h1 { font-size: 1.8rem; }
  button, a { font-size: 0.9rem; }
}
</style>
</head>
<body class="bg-gray-900 text-white min-h-screen">

<!-- Navbar -->
<div class="flex flex-wrap justify-between items-center p-4">
  <div class="space-x-2 mb-2 sm:mb-0">
    <button onclick="setLanguage('en')" class="px-3 py-1 bg-blue-600 rounded">EN</button>
    <button onclick="setLanguage('si')" class="px-3 py-1 bg-green-600 rounded">à·ƒà·’à¶‚</button>
    <button onclick="setLanguage('ta')" class="px-3 py-1 bg-pink-600 rounded">à®¤à®®à®¿à®´à¯</button>
  </div>
  <div>
    <button id="ownerLoginBtn" onclick="showOwnerLogin()" class="px-4 py-2 bg-gray-700 rounded">ğŸ” Owner Access</button>
    <button id="logoutBtn" onclick="logoutOwner()" class="hidden px-4 py-2 bg-red-600 rounded ml-2">ğŸšª Logout</button>
  </div>
</div>

<!-- Main -->
<div class="flex flex-col items-center justify-center text-center p-4">
  <h1 data-i18n="title" class="text-4xl sm:text-5xl font-bold my-4 text-purple-400">Member Management System</h1>
  <div class="flex flex-col sm:flex-row gap-3">
    <button onclick="openForm()" class="px-6 py-3 bg-blue-600 rounded-lg text-lg" data-i18n="addMember">â• Add New Member</button>
    <button onclick="loadMembers()" class="px-6 py-3 bg-green-600 rounded-lg text-lg" data-i18n="viewMembers">ğŸ“‹ View All Members</button>
  </div>

  <div class="flex flex-wrap justify-center gap-3 mt-6">
    <a href="terms1.pdf" target="_blank" class="px-4 py-2 bg-purple-600 rounded" data-i18n="terms1">ğŸ“œ Committee Terms (1)</a>
    <a href="terms2.pdf" target="_blank" class="px-4 py-2 bg-teal-600 rounded" data-i18n="terms2">ğŸ“œ Committee Terms (2)</a>
    <a href="terms3.pdf" target="_blank" class="px-4 py-2 bg-red-600 rounded" data-i18n="terms3">ğŸ“œ Committee Terms (3)</a>
  </div>
</div>

<div id="status" class="text-center mt-4 text-lg"></div>

<!-- Members Table -->
<div id="membersTable" class="hidden p-4 overflow-x-auto">
  <h2 class="text-2xl mb-4 text-center" data-i18n="membersList">ğŸ“‹ Members List</h2>
  <table class="table-auto w-full border border-gray-600 rounded-lg">
    <thead>
      <tr class="bg-gray-800">
        <th class="px-4 py-2" data-i18n="memberId">Member ID</th>
        <th class="px-4 py-2" data-i18n="name">Name</th>
        <th class="px-4 py-2" data-i18n="birthday">Birthday</th>
        <th class="px-4 py-2" data-i18n="sex">Sex</th>
        <th class="px-4 py-2" data-i18n="family">Family</th>
        <th class="px-4 py-2" data-i18n="actions">Actions</th>
      </tr>
    </thead>
    <tbody id="membersBody" class="text-center"></tbody>
  </table>
  <div id="ownerTools" class="hidden mt-4 flex flex-wrap gap-3 justify-center">
    <button onclick="downloadJSON()" class="px-4 py-2 bg-purple-600 rounded" data-i18n="downloadJSON">ğŸ’¾ Download JSON</button>
    <button onclick="downloadPDF()" class="px-4 py-2 bg-yellow-600 rounded" data-i18n="downloadPDF">ğŸ“• Download PDF</button>
  </div>
</div>

<!-- Pending Members Table -->
<div id="pendingTable" class="hidden p-4 overflow-x-auto">
  <h2 class="text-2xl mb-4 text-center" data-i18n="pendingMembers">ğŸ•’ Pending Members</h2>
  <table class="table-auto w-full border border-gray-600 rounded-lg">
    <thead>
      <tr class="bg-gray-800">
        <th class="px-4 py-2" data-i18n="name">Name</th>
        <th class="px-4 py-2" data-i18n="birthday">Birthday</th>
        <th class="px-4 py-2" data-i18n="sex">Sex</th>
        <th class="px-4 py-2" data-i18n="family">Family</th>
        <th class="px-4 py-2" data-i18n="actions">Actions</th>
      </tr>
    </thead>
    <tbody id="pendingBody" class="text-center"></tbody>
  </table>
</div>

<!-- Add Member Modal -->
<div id="formModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4">
  <div class="bg-gray-800 p-6 rounded-lg w-full max-w-sm">
    <h2 class="text-2xl mb-4 text-center" data-i18n="addMemberModal">Add Member</h2>
    <form id="memberForm" class="space-y-3">
      <input type="text" id="name" placeholder="Name" data-i18n-placeholder="name" required class="w-full p-2 rounded bg-gray-700">
      <input type="date" id="birthday" required class="w-full p-2 rounded bg-gray-700">
      <select id="sex" required class="w-full p-2 rounded bg-gray-700">
        <option value="" data-i18n="selectSex">Select Sex</option>
        <option value="Male" data-i18n="male">Male</option>
        <option value="Female" data-i18n="female">Female</option>
      </select>
      <textarea id="family" placeholder="Family Members" data-i18n-placeholder="family" class="w-full p-2 rounded bg-gray-700"></textarea>
      <button type="submit" class="w-full py-2 bg-blue-600 rounded" data-i18n="save">Save</button>
    </form>
    <button onclick="closeForm()" class="mt-4 w-full py-2 bg-red-600 rounded" data-i18n="close">Close</button>
  </div>
</div>

<!-- Edit Member Modal -->
<div id="editModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4">
  <div class="bg-gray-800 p-6 rounded-lg w-full max-w-sm">
    <h2 class="text-2xl mb-4 text-center" data-i18n="editMemberModal">Edit Member</h2>
    <form id="editForm" class="space-y-3">
      <input type="text" id="editMemberId" placeholder="Member ID" required class="w-full p-2 rounded bg-gray-700">
      <input type="text" id="editName" placeholder="Name" required class="w-full p-2 rounded bg-gray-700">
      <input type="date" id="editBirthday" required class="w-full p-2 rounded bg-gray-700">
      <select id="editSex" required class="w-full p-2 rounded bg-gray-700">
        <option value="">Select Sex</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
      </select>
      <textarea id="editFamily" placeholder="Family Members" class="w-full p-2 rounded bg-gray-700"></textarea>
      <button type="submit" class="w-full py-2 bg-green-600 rounded" data-i18n="saveChanges">Save Changes</button>
    </form>
    <button onclick="closeEditModal()" class="mt-4 w-full py-2 bg-red-600 rounded" data-i18n="close">Close</button>
  </div>
</div>

<!-- Owner Login Modal -->
<div id="ownerModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4">
  <div class="bg-gray-800 p-6 rounded-lg w-full max-w-sm">
    <h2 class="text-2xl mb-4 text-center" data-i18n="ownerLogin">Owner Login</h2>
    <form id="ownerForm" class="space-y-3">
      <input type="email" id="ownerEmail" placeholder="Email" required class="w-full p-2 rounded bg-gray-700">
      <input type="password" id="ownerPassword" placeholder="Password" required class="w-full p-2 rounded bg-gray-700">
      <button type="submit" class="w-full py-2 bg-green-600 rounded" data-i18n="unlock">Unlock</button>
    </form>
    <button onclick="closeOwnerLogin()" class="mt-4 w-full py-2 bg-red-600 rounded" data-i18n="close">Close</button>
  </div>
</div>

<script>
/* Translation Texts */
const translations = {
  en: {
    title:"Member Management System", addMember:"â• Add New Member", viewMembers:"ğŸ“‹ View All Members",
    terms1:"ğŸ“œ Committee Terms (1)", terms2:"ğŸ“œ Committee Terms (2)", terms3:"ğŸ“œ Committee Terms (3)",
    membersList:"ğŸ“‹ Members List", memberId:"Member ID", name:"Name", birthday:"Birthday",
    sex:"Sex", family:"Family", actions:"Actions", pendingMembers:"ğŸ•’ Pending Members",
    addMemberModal:"Add Member", selectSex:"Select Sex", male:"Male", female:"Female",
    save:"Save", close:"Close", editMemberModal:"Edit Member", saveChanges:"Save Changes",
    ownerLogin:"Owner Login", unlock:"Unlock", submitted:"âœ… Member submitted for approval!", 
    updated:"âœ… Member updated!", deleted:"ğŸ—‘ï¸ Member deleted!"
  },
  si: {
    title:"à·ƒà·à¶¸à·à¶¢à·’à¶š à¶šà·…à¶¸à¶±à·à¶šà¶»à¶« à¶´à¶¯à·Šà¶°à¶­à·’à¶º", addMember:"â• à¶±à·€ à·ƒà·à¶¸à·à¶¢à·’à¶šà¶ºà·™à¶šà·Š à¶‘à¶šà·Š à¶šà¶»à¶±à·Šà¶±", viewMembers:"ğŸ“‹ à·ƒà·’à¶ºà¶½à·” à·ƒà·à¶¸à·à¶¢à·’à¶šà¶ºà·’à¶±à·Š à¶¶à·à¶½à·“à¶¸",
    terms1:"ğŸ“œ à¶šà¶¸à·’à¶§à·” à¶±à·’à¶ºà¶¸à¶ºà¶±à·Š (1)", terms2:"ğŸ“œ à¶šà¶¸à·’à¶§à·” à¶±à·’à¶ºà¶¸à¶ºà¶±à·Š (2)", terms3:"ğŸ“œ à¶šà¶¸à·’à¶§à·” à¶±à·’à¶ºà¶¸à¶ºà¶±à·Š (3)",
    membersList:"ğŸ“‹ à·ƒà·à¶¸à·à¶¢à·’à¶š à¶½à·à¶ºà·’à·ƒà·Šà¶­à·”à·€", memberId:"à·ƒà·à¶¸à·à¶¢à·’à¶š à¶…à¶‚à¶šà¶º", name:"à¶±à¶¸", birthday:"à¶‹à¶´à¶±à·Š à¶¯à·’à¶±à¶º",
    sex:"à·ƒà·Šà¶­à·Šâ€à¶»à·“/à¶´à·”à¶»à·”à·‚ à¶·à·à·€à¶º", family:"à¶´à·€à·”à¶½", actions:"à¶šà·Šâ€à¶»à·’à¶ºà·", pendingMembers:"ğŸ•’ à¶¶à¶½à·à·ƒà·’à¶§à·’à¶± à·ƒà·à¶¸à·à¶¢à·’à¶šà¶ºà·’à¶±à·Š",
    addMemberModal:"à·ƒà·à¶¸à·à¶¢à·’à¶šà¶ºà·™à¶šà·Š à¶‘à¶šà·Š à¶šà¶»à¶±à·Šà¶±", selectSex:"à·ƒà·Šà¶­à·Šâ€à¶»à·“/à¶´à·”à¶»à·”à·‚ à¶·à·à·€à¶º à¶­à·à¶»à¶±à·Šà¶±", male:"à¶´à·’à¶»à·’à¶¸à·’", female:"à¶œà·à·„à·à¶«à·”",
    save:"à·ƒà·”à¶»à¶šà·’à¶±à·Šà¶±", close:"à¶‰à·€à¶­à·Š à¶šà¶»à¶±à·Šà¶±", editMemberModal:"à·ƒà·à¶¸à·à¶¢à·’à¶šà¶ºà· à·ƒà¶‚à·ƒà·Šà¶šà¶»à¶«à¶º à¶šà¶»à¶±à·Šà¶±", saveChanges:"à·€à·™à¶±à·ƒà·Šà¶šà¶¸à·Š à·ƒà·”à¶»à¶šà·’à¶±à·Šà¶±",
    ownerLogin:"à¶…à¶ºà·’à¶­à·’à¶šà¶»à·” à¶…à¶·à·’à¶»à·”à¶ à·’ à¶´à·’à·€à·’à·ƒà·”à¶¸", unlock:"à·€à·’à·€à·˜à¶­ à¶šà¶»à¶±à·Šà¶±", submitted:"âœ… à·ƒà·à¶¸à·à¶¢à·’à¶šà¶ºà· à¶…à¶±à·”à¶¸à¶­ à¶šà·’à¶»à·“à¶¸à¶§ à¶‰à¶¯à·’à¶»à·’à¶´à¶­à·Š à¶šà¶»à¶± à¶½à¶¯à·’!", 
    updated:"âœ… à·ƒà·à¶¸à·à¶¢à·’à¶šà¶ºà· à¶ºà·à·€à¶­à·Šà¶šà·à¶½à·“à¶± à¶šà¶»à¶± à¶½à¶¯à·’!", deleted:"ğŸ—‘ï¸ à·ƒà·à¶¸à·à¶¢à·’à¶šà¶ºà· à¶¸à¶šà· à¶¯à¶¸à¶± à¶½à¶¯à·’!"
  },
  ta: {
    title:"à®‰à®±à¯à®ªà¯à®ªà®¿à®©à®°à¯ à®®à¯‡à®²à®¾à®£à¯à®®à¯ˆ à®…à®®à¯ˆà®ªà¯à®ªà¯", addMember:"â• à®ªà¯à®¤à®¿à®¯ à®‰à®±à¯à®ªà¯à®ªà®¿à®©à®°à¯ à®šà¯‡à®°à¯à®•à¯à®•à®µà¯à®®à¯", viewMembers:"ğŸ“‹ à®…à®©à¯ˆà®¤à¯à®¤à¯ à®‰à®±à¯à®ªà¯à®ªà®¿à®©à®°à¯à®•à®³à¯ˆà®¯à¯à®®à¯ à®ªà®¾à®°à¯à®•à¯à®•à®µà¯à®®à¯",
    terms1:"ğŸ“œ à®•à¯à®´à¯ à®µà®¿à®¤à®¿à®•à®³à¯ (1)", terms2:"ğŸ“œ à®•à¯à®´à¯ à®µà®¿à®¤à®¿à®•à®³à¯ (2)", terms3:"ğŸ“œ à®•à¯à®´à¯ à®µà®¿à®¤à®¿à®•à®³à¯ (3)",
    membersList:"ğŸ“‹ à®‰à®±à¯à®ªà¯à®ªà®¿à®©à®°à¯ à®ªà®Ÿà¯à®Ÿà®¿à®¯à®²à¯", memberId:"à®‰à®±à¯à®ªà¯à®ªà®¿à®©à®°à¯ à®à®Ÿà®¿", name:"à®ªà¯†à®¯à®°à¯", birthday:"à®ªà®¿à®±à®¨à¯à®¤ à®¤à¯‡à®¤à®¿",
    sex:"à®ªà®¾à®²à®¿à®©à®®à¯", family:"à®•à¯à®Ÿà¯à®®à¯à®ªà®®à¯", actions:"à®šà¯†à®¯à®²à¯à®•à®³à¯", pendingMembers:"ğŸ•’ à®¨à®¿à®²à¯à®µà¯ˆà®¯à®¿à®²à¯ à®‰à®³à¯à®³ à®‰à®±à¯à®ªà¯à®ªà®¿à®©à®°à¯à®•à®³à¯",
    addMemberModal:"à®‰à®±à¯à®ªà¯à®ªà®¿à®©à®°à¯ à®šà¯‡à®°à¯à®•à¯à®•à®µà¯à®®à¯", selectSex:"à®ªà®¾à®²à®¿à®©à®®à¯ à®¤à¯‡à®°à¯à®¨à¯à®¤à¯†à®Ÿà¯à®•à¯à®•à®µà¯à®®à¯", male:"à®†à®£à¯", female:"à®ªà¯†à®£à¯",
    save:"à®šà¯‡à®®à®¿à®•à¯à®•à®µà¯à®®à¯", close:"à®®à¯‚à®Ÿà¯", editMemberModal:"à®‰à®±à¯à®ªà¯à®ªà®¿à®©à®°à¯ˆ à®¤à®¿à®°à¯à®¤à¯à®¤à®µà¯à®®à¯", saveChanges:"à®®à®¾à®±à¯à®±à®™à¯à®•à®³à¯ˆà®šà¯ à®šà¯‡à®®à®¿à®•à¯à®•à®µà¯à®®à¯",
    ownerLogin:"à®‰à®°à®¿à®®à¯ˆà®¯à®¾à®³à®°à¯ à®‰à®³à¯à®¨à¯à®´à¯ˆà®µà¯", unlock:"à®¤à®¿à®±à®•à¯à®•à®µà¯à®®à¯", submitted:"âœ… à®‰à®±à¯à®ªà¯à®ªà®¿à®©à®°à¯ à®’à®ªà¯à®ªà¯à®¤à®²à¯à®•à¯à®•à®¾à®• à®šà®®à®°à¯à®ªà¯à®ªà®¿à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿà®¾à®°à¯!", 
    updated:"âœ… à®‰à®±à¯à®ªà¯à®ªà®¿à®©à®°à¯ à®ªà¯à®¤à¯à®ªà¯à®ªà®¿à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿà®¾à®°à¯!", deleted:"ğŸ—‘ï¸ à®‰à®±à¯à®ªà¯à®ªà®¿à®©à®°à¯ à®¨à¯€à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®Ÿà®¤à¯!"
  }
};

/* Function to set translations */
function setLanguage(lang){
  document.querySelectorAll("[data-i18n]").forEach(el=>{
    if(translations[lang][el.getAttribute("data-i18n")]) el.textContent = translations[lang][el.getAttribute("data-i18n")];
  });
  document.querySelectorAll("[data-i18n-placeholder]").forEach(el=>{
    if(translations[lang][el.getAttribute("data-i18n-placeholder")]) el.placeholder = translations[lang][el.getAttribute("data-i18n-placeholder")];
  });
}

/* Firebase Setup */
const firebaseConfig = {
  apiKey:"AIzaSyANUfgVwR0uWPOaFzf1GrehpfitR1sUGw0",
  authDomain:"project01-d5df2.firebaseapp.com",
  projectId:"project01-d5df2",
  storageBucket:"project01-d5df2.firebasestorage.app",
  messagingSenderId:"398259647179",
  appId:"1:398259647179:web:54c78c2144a5d70e58614e",
  measurementId:"G-Q1ZVC5C7LZ"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore(), auth = firebase.auth();

/* DOM references */
let isOwner=false, currentEditId=null;
const ownerLoginBtn=document.getElementById("ownerLoginBtn");
const logoutBtn=document.getElementById("logoutBtn");
const ownerTools=document.getElementById("ownerTools");
const pendingTable=document.getElementById("pendingTable");
const membersTable=document.getElementById("membersTable");

/* Form & Modal Controls */
const openForm=()=>document.getElementById("formModal").classList.remove("hidden");
const closeForm=()=>document.getElementById("formModal").classList.add("hidden");
const showOwnerLogin=()=>document.getElementById("ownerModal").classList.remove("hidden");
const closeOwnerLogin=()=>document.getElementById("ownerModal").classList.add("hidden");
const closeEditModal=()=>{ currentEditId=null; document.getElementById("editModal").classList.add("hidden"); }

/* Status Display */
const showStatus=(msg,s=true)=>{
  const el=document.getElementById("status");
  el.textContent=msg;
  el.className = s?"text-green-400 mt-4":"text-red-400 mt-4";
};

/* Member Submission */
document.getElementById("memberForm").addEventListener("submit", async e=>{
  e.preventDefault();
  const data={
    name:document.getElementById("name").value,
    birthday:document.getElementById("birthday").value,
    sex:document.getElementById("sex").value,
    family:document.getElementById("family").value,
    submittedAt:new Date()
  };
  try{
    await db.collection("pendingMembers").add(data);
    showStatus(translations['en'].submitted);
    document.getElementById("memberForm").reset();
    closeForm();
  }catch(err){ showStatus("âŒ "+err.message,false); }
});

/* Load Members Table */
async function loadMembers(){
  const table=membersTable, body=document.getElementById("membersBody");
  body.innerHTML="";
  const snapshot=await db.collection("members").get();
  snapshot.forEach(doc=>{
    const m=doc.data();
    body.innerHTML+=`<tr class="border-b border-gray-700">
      <td>${m.memberId||"-"}</td>
      <td>${m.name}</td>
      <td>${m.birthday}</td>
      <td>${m.sex}</td>
      <td>${m.family}</td>
      <td>${isOwner?`<button onclick="editMember('${doc.id}')" class='bg-yellow-600 px-2 py-1 rounded'>âœï¸</button>
      <button onclick="deleteMember('${doc.id}')" class='bg-red-600 px-2 py-1 rounded ml-1'>âŒ</button>`:"-"}</td>
    </tr>`;
  });
  table.classList.remove("hidden");
  if(isOwner) ownerTools.classList.remove("hidden");
}

/* Load Pending Members */
async function loadPendingMembers(){
  if(!isOwner) return;
  const body=document.getElementById("pendingBody");
  body.innerHTML="";
  const snapshot=await db.collection("pendingMembers").get();
  snapshot.forEach(doc=>{
    const m=doc.data();
    body.innerHTML+=`<tr class="border-b border-gray-700">
      <td>${m.name}</td>
      <td>${m.birthday}</td>
      <td>${m.sex}</td>
      <td>${m.family}</td>
      <td>
        <button onclick="approveMember('${doc.id}')" class='bg-green-600 px-2 py-1 rounded'>âœ…</button>
        <button onclick="deletePending('${doc.id}')" class='bg-red-600 px-2 py-1 rounded'>âŒ</button>
      </td>
    </tr>`;
  });
  pendingTable.classList.remove("hidden");
}

/* Owner Login */
document.getElementById("ownerForm").addEventListener("submit", async e=>{
  e.preventDefault();
  const ownerEmail=document.getElementById("ownerEmail").value;
  const ownerPassword=document.getElementById("ownerPassword").value;
  try{
    await auth.signInWithEmailAndPassword(ownerEmail,ownerPassword);
    isOwner=true;
    showStatus("ğŸ”“ Owner Access Granted!");
    ownerLoginBtn.classList.add("hidden");
    logoutBtn.classList.remove("hidden");
    closeOwnerLogin();
    loadMembers();
    loadPendingMembers();
  }catch(err){ showStatus("âŒ Login failed: "+err.message,false); }
});

/* Logout Owner */
function logoutOwner(){
  auth.signOut().then(()=>{
    isOwner=false;
    showStatus("ğŸ”’ Owner Logged Out");
    ownerLoginBtn.classList.remove("hidden");
    logoutBtn.classList.add("hidden");
    ownerTools.classList.add("hidden");
    pendingTable.classList.add("hidden");
    loadMembers();
  });
}

/* Delete / Approve Members */
async function deleteMember(id){ if(!isOwner) return; await db.collection("members").doc(id).delete(); showStatus(translations['en'].deleted); loadMembers(); }
async function deletePending(id){ if(!isOwner) return; await db.collection("pendingMembers").doc(id).delete(); showStatus(translations['en'].deleted); loadPendingMembers(); }
async function approveMember(id){
  const ref=db.collection("pendingMembers").doc(id), snap=await ref.get();
  if(snap.exists){
    const data=snap.data(), snapshot=await db.collection("members").get();
    const newId="M"+String(snapshot.size+1).padStart(3,"0");
    data.memberId=newId;
    await db.collection("members").add(data);
    await ref.delete();
    showStatus(`âœ… Member approved! ID: ${newId}`);
    loadMembers(); loadPendingMembers();
  }
}

/* Edit Member */
function editMember(id){
  currentEditId=id;
  db.collection("members").doc(id).get().then(doc=>{
    if(doc.exists){
      const m=doc.data();
      document.getElementById("editMemberId").value=m.memberId||"";
      document.getElementById("editName").value=m.name;
      document.getElementById("editBirthday").value=m.birthday;
      document.getElementById("editSex").value=m.sex;
      document.getElementById("editFamily").value=m.family;
      document.getElementById("editModal").classList.remove("hidden");
    }
  });
}
document.getElementById("editForm").addEventListener("submit", async e=>{
  e.preventDefault();
  if(!currentEditId) return;
  try{
    await db.collection("members").doc(currentEditId).update({
      memberId: document.getElementById("editMemberId").value,
      name: document.getElementById("editName").value,
      birthday: document.getElementById("editBirthday").value,
      sex: document.getElementById("editSex").value,
      family: document.getElementById("editFamily").value
    });
    showStatus(translations['en'].updated);
    closeEditModal();
    loadMembers();
  }catch(err){ showStatus("âŒ "+err.message,false); }
});

/* Download Data */
async function downloadJSON(){
  const snap=await db.collection("members").get();
  const data=snap.docs.map(d=>d.data());
  const blob=new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob); a.download="members.json"; a.click();
}
async function downloadPDF(){
  const {jsPDF}=window.jspdf, doc=new jsPDF(); let y=20;
  const snap=await db.collection("members").get();
  snap.forEach(d=>{ const m=d.data(); doc.text(`ID:${m.memberId} | ${m.name} | ${m.birthday} | ${m.sex} | ${m.family}`,10,y); y+=8; });
  doc.save("members.pdf");
}
</script>
</body>
</html>
